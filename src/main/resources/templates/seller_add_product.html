<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Add Product</title>
</head>
<body>
  <h2>Add New Product</h2>

  <form id="productForm">
    <label>Name:</label>
    <input type="text" id="name" required><br>

    <label>Description:</label>
    <textarea id="description" required></textarea><br>

    <label>Price:</label>
    <input type="number" id="price" required><br>

    <label>Category:</label>
    <input type="text" id="category" required><br>

    <label>Stock:</label>
    <input type="number" id="stock" required><br>

    <label>Location:</label>
    <input type="text" id="location" required><br>

    <label>Image:</label>
    <input type="file" id="image" accept="image/*" required><br>

    <button type="submit">Add Product</button>
  </form>

  <p id="message"></p>

  <a href="/sellers/dashboard">⬅ Back to Dashboard</a>

  <script>
    document.getElementById("productForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const sellerId = localStorage.getItem("sellerId");
      if (!sellerId) {
        alert("⚠️ Seller not logged in!");
        window.location.href = "/sellers/login";
        return;
      }

      const formData = new FormData();
      formData.append("name", document.getElementById("name").value);
      formData.append("description", document.getElementById("description").value);
      formData.append("price", document.getElementById("price").value);
      formData.append("category", document.getElementById("category").value);
      formData.append("stock", document.getElementById("stock").value);
      formData.append("location", document.getElementById("location").value);
      formData.append("sellerId", sellerId);
      formData.append("image", document.getElementById("image").files[0]);

      try {
        const res = await fetch("/api/products/add", {
          method: "POST",
          body: formData
        });

        if (res.ok) {
          document.getElementById("message").textContent = "✅ Product added successfully!";
          document.getElementById("productForm").reset();
        } else {
          document.getElementById("message").textContent = "❌ Failed to add product.";
        }
      } catch (error) {
        console.error(error);
        document.getElementById("message").textContent = "⚠️ Error: " + error.message;
      }
    });
  </script>
</body>
</html>
